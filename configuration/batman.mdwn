[[!meta title="B.A.T.M.A.N. mesh network"]]

B.A.T.M.A.N., a "Better Approach To Mobile Ad-hoc Networking", is an alternative to [[OLSR|olsrd]]. The current implementation is "batman-adv", which works on the Layer 2. This makes the network look like "one big switch". You can use whatever layer 3 protocol on top of that (ipv4, ipv6, ipx, etc.).

[[!toc levels=3]]

# Requirements

This documentation assumes the network card in [[ad-hoc]] mode, with specific settings:

batman-adv version
: 2012.0.0

channel
: 6

cell
: 02:51:48:72:03:11

# OS-specific instructions

## OpenWRT

Voir [[guides/ubnt+batman]] pour l'instant.

## Debian

This page is about installing B.A.T.M.A.N. on Debian. For other operating systems, see the [[Batman|batman]] page.

Sous Debian/Ubuntu, installer le package Debian pour batctl, qui permet de gérer le module kernel inclus dans Linux:

    sudo apt-get install -t squeeze-backports batctl linux-image

[!] Ceci demande peut-être un backport, qui est en cours de fabrication, voir [[!debbug 668237]] pour les détails.

Pour nos tests, ça fonctionnait très bien avec linux 3.2, avec batctl version 2012.0.0. On a également noté que la version du module de noyau batman-adv est 2011.4.0 pour linux 3.2. Il semble y avoir une couche de compatibilité dans les versions futures ?? à voir...

Si vous avez mis à jour votre noyau, il faut redémarrer la machine.

Activer le module kernel (la majorité des distributions Linux ont ce module par défaut)

    modprobe batman-adv

Procéder ensuite au reste de la configuration [[configuration/batman]].

## Arch linux

On besoin de l'[[AUR | https://aur.archlinux.org/]]

    # modprobe batman_adv
    $ yaourt -S batctl

# Operations

Afficher l'état:

    batctl if

Activer l'interface:

    ifconfig bat0 up

Voilà, on n'a pas d'adresses IP de configurées à ce stade (prochaine étape!), mais on peut faire des "pings" en utilisant les adresses MAC:

    batctl tcpdump wlan0
    batctl ping 00:11:22:33:44:55
    batctl traceroute 00:11:22:33:44:55

Autres commandes utiles pour voir les nodes locales (mesh seulement) ou toutes les nodes accessibles via le mesh (global):

    batctl translocal
    batctl transglobal

Ajouter manuellement une interface à batman:

    batctl if add wlan0

# Use our bat-hosts

You may have noticed that `batctl tcpdump` and other commands display MAC addresses, and tried to match these adresses to your network interfaces. Do no more! You can use our [[bat-hosts|configuration/bat-hosts]] file to let batman display nice, user-friendly names (such as 'boulette', our very first Ubiquiti "Bullet").

# Étape suivante

Voir [[la configuration IP|configuration/ip]].

# Diagnostiques

En général, batman ou le mode ad-hoc affiche régulièrement des messages kernel, on peut y accéder par:

    dmesg | tail

ou:

    tail -f /var/log/messages

Voir aussi la page [[ad-hoc]] si vous avez des difficultés avec le
lien physique.

# Références

 * [Main project page open-mesh.org](http://www.open-mesh.org/)
  * [batman-adv](http://www.open-mesh.org/projects/batman-adv/wiki)
  * [batman-adv quickstart guide](http://www.open-mesh.org/wiki/batman-adv/Quick-start-guide)
  * [user guide with most of the docs](http://www.open-mesh.org/wiki/open-mesh/UserDocs)
