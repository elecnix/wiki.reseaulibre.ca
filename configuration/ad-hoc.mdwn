[[!toc levels=3]]
[[!meta title="Ad-hoc network configuration"]]

# Debian configuration

This will bring up your network interface with an IP in the 10.0.0.0/8 range.

    iwconfig wlan0 mode ad-hoc essid mesh-mtl
    ifconfig wlan0 10.0.1.42 netmask 255.0.0.0 up

(!) http://linuxwireless.org/en/developers/Documentation/nl80211 - it seems the proper way to configure interfaces is not through iwconfig anymore. see [[!debbug 645055]] too.

# OpenWRT configuration

## Through the luci web interface

 1. enable the device by checking (./) the enable checkbox in the `Devices`
 2. choose an appropriate channel
 3. fill in the details

        Network Name (ESSID): mesh-mtl
        BSSID: <copy existing bssid>
        Mode: Independent (Ad-Hoc)
        Encryption: No Encryption
        Network: wlan <new>

Note the latter part is important: this segregates the wifi from the lan
bridge, which allows to stay have diffent networks for the diagnostic
wire and the wireless.

Then head for the `Network -> Interfaces` configuration page, enable the
wlan network and assign the following settings:

    Protocol: static
    IPv4-Address: 10.0.1.1
    IPv4-Netmask: 255.0.0.0
    Zone: lan
    Interface: wlan0

Leave the rest as is.

## Configuration file

The above yields the following configuration, in `/etc/config/wireless`:

    config 'wifi-device' 'radio0'
            option 'type' 'mac80211'
            option 'channel' '5'
            option 'macaddr' '00:90:4c:5f:00:2a'
            option 'hwmode' '11g'
            option 'disabled' '0'
    
    config 'wifi-iface'
            option 'device' 'radio0'
            option 'network' 'wlan0'
            option 'encryption' 'none'
            option 'ssid' 'mesh-mtl'
            option 'mode' 'adhoc'
            option 'bssid' '2A:96:BF:DD:8C:98'

And this chunk ends up in `/etc/config/network`:

    config 'interface' 'wlan0'
            option 'proto' 'static'
            option 'ifname' 'wlan0'
            option 'ipaddr' '10.0.1.1'
            option 'netmask' '255.0.0.0'
            option 'defaultroute' '0'
            option 'peerdns' '0'

also note that in the `/etc/config/firewall` file, you'll see that the
wlan0 interface is assigned to the lan zone:

    config 'zone'
            option 'name' 'lan'
            option 'input' 'ACCEPT'
            option 'output' 'ACCEPT'
            option 'forward' 'REJECT'
            option 'network' 'lan wlan0'

[[!meta copyright="Copyright © 2011 Antoine Beaupré"]]

[[!meta license="""[[!toggle id="license" text="GFDL 1.2+"]][[!toggleable
id="license" text="Permission is granted to copy, distribute and/or modify this
document under the terms of the GNU Free Documentation License, Version 1.2 or
any later version published by the Free Software Foundation; with no Invariant
Sections, no Front-Cover Texts, and no Back-Cover Texts.  A copy of the license
is included in the section entitled [[GNU Free Documentation
License|meta/gfdl]]."]]"""]]
