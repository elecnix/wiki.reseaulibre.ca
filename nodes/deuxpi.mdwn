### Vue vers le sud

[[!img panorama.jpg size="950x" alt="Vue du toit"]]

[[!ymlfront data="""
MAC: DC:9F:DB:00:11:D9
IP: 172.16.1.8
IPv6:
- 2001:470:b2a7::/48
"""]]

<hr/>
Sous les panneaux solaires, boulevard Lasalle, à Verdun

<img src="https://chart.googleapis.com/chart?cht=qr&chs=350x350&chld=L&chl=WIFI%3AT%3Anopass%3BS%3Aacces.reseaulibre.ca%3B%3B" class="img" align="right" alt="acces.reseaulibre.ca">

[[!waypoint lat="45.46919" lon="-73.56716" embed hidden width="550px" height="400px" right desc="Ubnt Bullet M2"]]

# À faire

 * <s>Faire passer un câble Ethernet entre la Bullet sur le toit et la salle des machines.</s>
 * Monter la Bullet haut haut haut!
 * <s>Installer le nouveau serveur/routeur dans la salle des machines.</s>
   * <s>Il faut réorganiser les alimentations électrique (présentement toutes occupées par le monitoring).</s>
   * <s>Il faut s'assurer qu'il y a moyen de raccorder autant le nouveau câble que le filage qui monte vers les appartements. Ces derniers ont été pensés pour être plus près des entrées de Bell et Vidéotron que des entrées électriques.</s>
 * <s>Tester Babel sur [Quagga](http://www.nongnu.org/quagga/) au lieu de babeld.</s>
 * Tester une configuration Batman/switch et Babel/routeur pour des grands sites qui pourraient profiter d'une topologie différente.
 * <s>Installer le point d'accès TP-Link déjà configuré.</s>
 * Assembler la station mobile solaire.
 * Ajouter un relais 5 GHz.

# Détails

 * MAC address: {{$MAC}}
 * IP address: {{$IP}}
 * IPv6 address: {{$IPv6}}
 * Software: OpenWRT (trunk)
 * Hardware: Ubiquiti Bullet M2
 * Power: 16 dBm ?, 15 dBi
 * Location: Verdun, coin LaSalle et Rushbrooke
 * Status: [[!taglink up]]
 * Links: [[nodes/bgm-homs]], [[nodes/bgm-latakia]], [[nodes/hexa]], [[nodes/scientist]], [[nodes/tarator]]
 * Azimuth: Omni
 * Panorama: [[Vue du site de l'installation|https://farm6.staticflickr.com/5223/5881898216_6198d24176.jpg]]
 * Operator: [[users/deuxpi]]

# Configuration Babel

[[!img reseau.png size="400x400" align="right"]]

## Routeur "relais" pinxo.mesh.deuxpi.ca

 * Adresse IPv4 172.16.1.8/32 sur br-lan et wlan0 (point-à-point, routage par Babel seulement)
 * Adresse IPv6 2001:470:b2a7:2::2/64 sur br-lan (fe80::de9f:dbff:fe01:11d9/64) et wlan0 (fe80::de9f:dbff:fe00:11d9/64)
 * Route IPv6 statique 2001:470:b2a7::/48 via 2001:470:b2a7:2::1 sur br-lan.

[[!format txt """
babeld.@general[0]=general
babeld.@general[0].local_server=33123
babeld.wlan0=interface
babeld.lan=interface
babeld.@filter[0]=filter
babeld.@filter[0].type=redistribute
babeld.@filter[0].local=true
babeld.@filter[0].ip=172.16.0.0/12
babeld.@filter[0].action=allow
babeld.@filter[1]=filter
babeld.@filter[1].type=redistribute
babeld.@filter[1].local=true
babeld.@filter[1].ip=2001:470:b2a7::/48
babeld.@filter[1].action=allow
babeld.@filter[2]=filter
babeld.@filter[2].type=redistribute
babeld.@filter[2].local=true
babeld.@filter[2].action=deny
"""]]

## Point d'accès acces.mesh.deuxpi.ca

 * Adresse IPv4 172.16.1.188/32 sur br-lan (point-à-point, routage par Babel seulement)
 * Adresse IPv4 192.168.8.1/24 sur wlan0 pour les clients
 * Adresse IPv6 2001:470:b2a7:2::1/64 sur br-lan (fe80::fad1:11ff:fe91:218/64) et wlan0 (fe80::fad1:11ff:fe91:218/64)
 * Route IPv6 statique 2001:470:b2a7:1::/64 vers le laptop sur wlan0 pour lien avec laptop, le réseau local et le VPN.

[[!format txt """
package babeld

config general
	option local_server '33123'

config interface 'lan'
	option wired 'true'

config interface 'wlan0'

config filter
	option type 'redistribute'
	option local 'true'
	option ip '192.168.8.0/24'
	option le '24'
	option proto '2'
	option action 'allow'

config filter
	option type 'redistribute'
	option local 'true'
	option ip '172.16.0.0/12'
	option action 'allow'

config filter
	option type 'redistribute'
	option local 'true'
	option ip '2001:470:b2a7:2::/64'
	option proto '2'
	option action 'allow'

config filter
	option type 'in'
	option ip '2001:470:b2a7::/48'
	option action 'deny'

config filter
	option type 'redistribute'
	option proto '3'
	option action 'deny'

config filter
	option type 'redistribute'
	option local 'true'
	option action 'deny'
"""]]

## Serveur gelato.mesh.deuxpi.ca

 * Adresse IPv4 172.16.1.181/32 sur mesh (VPN)
 * Adresse IPv4 sur eth1 obtenue du routeur du réseau local.
 * Adresse IPv6 2001:470:b2a7:1:225:90ff:fe94/64 sur eth0.
 * VPN vers [[nodes/roadkiller]]

Ce serveur est un peu différent des autres machines sur le réseau mesh puisqu'il roule le logiciel de routage Quagga au lieu du code "standalone" babeld. Les instructions d'installation sont décrites à https://www.deuxpi.ca/wiki/Quagga-RE pour ce serveur.

### Configuration DNS

Ce serveur DNS avec Bind sert les zones mesh.deuxpi.ca et reseaulibre.ca et la zone inverse pour 2001:470:b2a7::/48. Il est prévu que ce service soit distribué avec une adresse anycast. Ici on a choisi 172.16.0.53. Le serveur écoute aussi sur l'adresse unicast 2001:470:b2a7::53.

[[!format txt """
// /etc/bind/named.conf.options
options {
    directory "/var/cache/bind";
    forwarders {
        192.168.1.1;
    };
    dnssec-validation: auto;
    auth-nxdomain no;
    minimal-responses yes;
    listen-on { 127.0.0.1; 172.16.0.53; };
    listen-on-v6 { 2001:470:b2a7::53; };
    query-source-v6 address 2001:470:b2a7:1:225:90ff:fe93:e9fc;
    dns64 2001:470:b2a7:1:ffff::/96 {
        clients { any; };
    };
    // allow-transfer { ... };
};
"""]]

[[!format txt """
// /etc/bind/named.conf.local
zone "mesh.deuxpi.ca" {
    type master;
    file "/etc/bind/db.mesh.deuxpi.ca";
};

zone "7.a.2.b.0.7.4.0.1.0.0.2.ip6.arpa" {
    type master;
    file "/etc/bind/db.7.a.2.b.0.7.4.0.1.0.0.2";
};

zone "reseaulibre.ca" {
    type master;
    file "/etc/bind/db.reseaulibre.ca";
};

zone "16.172.in-addr.arpa" {
    type master;
    file "/etc/bind/db.16.172.in-addr.arpa";
};
"""]]

### Serveur de jeux

Le serveur gelato offre quelques jeux pour des fins de démonstration. Pour les essayer, connectez-vous via telnet à nethack.deuxpi.ca pour une partie de NetHack, ou utilisez l'adresse tetrinet.deuxpi.ca pour rejoindre un serveur Tetrinet.

### Autres services

Un serveur de clés publiques PGP est disponible. Par exemple pour obtenir une clé de ce serveur (ici c'est la clé Monkeysphere du serveur), on peut lancer:

[[!format txt """
gpg --keyserver keyserver.mesh.deuxpi.ca --recv-key 86B3721B
"""]]

## Extras

Pour obtenir la liste des noeuds connectés et leurs niveaux de signal respectifs, j'utilise le script [[bat-signal|https://gitorious.org/deuxpi-docs/deuxpi-docs/blobs/raw/master/bat-signal]]. Si le fichier [[documentation/batman/bat-hosts]] est disponible, le nom des noeuds sera affiché en plus de leur adresse MAC.

En cours de développement, une [interface curses](https://gitorious.org/babelcurse) pour suivre Babel. Les [paquets OpenWRT](http://www.deuxpi.ca/babelcurse/) sont aussi disponibles.


[[!meta copyright="Copyright © 2012-2013 Philippe Gauthier"]]

[[!meta license="""[[!toggle id="license" text="GFDL 1.2+"]][[!toggleable
id="license" text="Permission is granted to copy, distribute and/or modify this
document under the terms of the GNU Free Documentation License, Version 1.2 or
any later version published by the Free Software Foundation; with no Invariant
Sections, no Front-Cover Texts, and no Back-Cover Texts.  A copy of the license
is included in the section entitled [[GNU Free Documentation
License|meta/gfdl]]."]]"""]]

