[[!ymlfront data="""
MAC: DC:9F:DB:0A:59:82
IP: 172.16.3.25
IPv6: fd64:2c08:9fa7:be40::1
"""]]

# SETUP

[[!waypoint lat="45.521123" lon="-73.585782" embed hidden width="950px" height="400px" right desc="Sur le toît de l'intermarché"]]

Operator: colonialemt(à)gmail.com, [[users/wahben]] sur IRC

Bullet M2 + 15dBi

# NODE - r-pop.relais.reseaulibre.ca

 * Status: [[!taglink up]]
 * Hostname: benode.relais.reseaulibre.ca
 * Location: 45.521123,-73.585782
 * Software: OpenWRT 12.09 RC1
 * IP address: {{$IP}}
 * IPv6 address: {{$IPv6}}
 * Routage: 
 * Hardware: Ubnt Bullet M2
 * MAC address: {{$MAC}}
 * Channel: 1
 * 802.11: b, g, n
 * Autonomie estimée: ?

### Antenna
 * Azimuth: H: 360° / V: 6°
 * Frequency: 2400 - 2483MHz
 * Gain: 15 dBi
 * Polarization: Vertical
 * SWR : ≤ 1.5:1
 * Impedance: 50 Ohm
 * Power: 

### Services prévus
 * Minecraft
 * File sharing

### Installation

Antenne: <img src="http://i.imgur.com/JPdsLqZ.jpg" width=940" />

### Info de configuration

/etc/config/babeld

    package babeld

    config general
	    option local_server '33123'

    config interface wan
	    option wired 'false'
	    #option update_interval '16'

    config interface lan
	    #option ignore 'true'
	    option wired 'true'
	    option update_interval '16'	 

    #config filter
    #	option type 'redistribute'
    #	option ge '13'
    #	option ip '172.16.0.0/12'
    #	option action 'metric 128'

    #config filter
    #	option type 'redistribute'
    #	option local 'true'
    #	option ip '192.68.5.0/24'
    #	option action 'deny'

/etc/firewall.user

    # This file is interpreted as shell script.
    # Put your custom iptables rules here, they will
    # be executed with each firewall (re-)start.
    #insmod ipt_LOG.o
    #iptables -A input_rule -i eth0 -j LOG --log-prefix "IN eth0: "

/etc/config/firewall

    config defaults
	    option syn_flood	1
	    option input		ACCEPT
	    option output		ACCEPT
	    option forward		REJECT
    # Uncomment this line to disable ipv6 rules
    #	option disable_ipv6	1

    config zone
	    option name		lan
	    option network		'lan'
	    option input		ACCEPT
	    option output		ACCEPT
	    option forward		REJECT

    config zone
	    option name		wan
	    option network		'wan'
	    option input		ACCEPT
	    option output		ACCEPT
	    option forward		REJECT
	    option masq		1
	    option mtu_fix		1

    config forwarding
	    option src		lan
	    option dest		wan


    # We need to accept udp packets on port 68,
    # see https://dev.openwrt.org/ticket/4108
    config rule
	    option name		Allow-DHCP-Renew
	    option src		wan
	    option proto		udp
	    option dest_port	68
	    option target		ACCEPT
	    option family		ipv4

    # Allow IPv4 ping
    config rule
	    option name		Allow-Ping
	    option src		wan
	    option proto		icmp
	    option icmp_type	echo-request
	    option family		ipv4
	    option target		ACCEPT

    # Allow DHCPv6 replies
    # see https://dev.openwrt.org/ticket/10381
    config rule
	    option name		Allow-DHCPv6
	    option src		wan
	    option proto		udp
	    option src_ip		fe80::/10
	    option src_port		547
	    option dest_ip		fe80::/10
	    option dest_port	546
	    option family		ipv6
	    option target		ACCEPT

    # Allow essential incoming IPv6 ICMP traffic
    config rule
	    option name		Allow-ICMPv6-Input
	    option src		wan
	    option proto	icmp
	    list icmp_type		echo-request
	    list icmp_type		echo-reply
	    list icmp_type		destination-unreachable
	    list icmp_type		packet-too-big
	    list icmp_type		time-exceeded
	    list icmp_type		bad-header
	    list icmp_type		unknown-header-type
	    list icmp_type		router-solicitation
	    list icmp_type		neighbour-solicitation
	    list icmp_type		router-advertisement
	    list icmp_type		neighbour-advertisement
	    option limit		1000/sec
	    option family		ipv6
	    option target		ACCEPT

    # Allow essential forwarded IPv6 ICMP traffic
    config rule
	    option name		Allow-ICMPv6-Forward
	    option src		wan
	    option dest		*
	    option proto		icmp
	    list icmp_type		echo-request
	    list icmp_type		echo-reply
	    list icmp_type		destination-unreachable
	    list icmp_type		packet-too-big
	    list icmp_type		time-exceeded
	    list icmp_type		bad-header
	    list icmp_type		unknown-header-type
	    option limit		1000/sec
	    option family		ipv6
	    option target		ACCEPT

    # include a file with users custom iptables rules
    config include
	    option path /etc/firewall.user


    ### EXAMPLE CONFIG SECTIONS
    # do not allow a specific ip to access wan
    #config rule
    #	option src		lan
    #	option src_ip	192.168.45.2
    #	option dest		wan
    #	option proto	tcp
    #	option target	REJECT

    # block a specific mac on wan
    #config rule
    #	option dest		wan
    #	option src_mac	00:11:22:33:44:66
    #	option target	REJECT

    # block incoming ICMP traffic on a zone
    #config rule
    #	option src		lan
    #	option proto	ICMP
    #	option target	DROP

    # port redirect port coming in on wan to lan
    #config redirect
    #	option src			wan
    #	option src_dport	80
    #	option dest			lan
    #	option dest_ip		192.168.16.235
    #	option dest_port	80
    #	option proto		tcp

    # port redirect of remapped ssh port (22001) on wan
    #config redirect
    #	option src		wan
    #	option src_dport	22001
    #	option dest		lan
    #	option dest_port	22
    #	option proto		tcp

    # allow IPsec/ESP and ISAKMP passthrough
    #config rule
    #	option src		wan
    #	option dest		lan
    #	option protocol		esp
    #	option target		ACCEPT

    #config rule
    #	option src		wan
    #	option dest		lan
    #	option src_port		500
    #	option dest_port	500
    #	option proto		udp
    #	option target		ACCEPT

    ### FULL CONFIG SECTIONS
    #config rule
    #	option src		lan
    #	option src_ip	192.168.45.2
    #	option src_mac	00:11:22:33:44:55
    #	option src_port	80
    #	option dest		wan
    #	option dest_ip	194.25.2.129
    #	option dest_port	120
    #	option proto	tcp
    #	option target	REJECT

    #config redirect
    #	option src		lan
    #	option src_ip	192.168.45.2
    #	option src_mac	00:11:22:33:44:55
    #	option src_port		1024
    #	option src_dport	80
    #	option dest_ip	194.25.2.129
    #	option dest_port	120
    #	option proto	tcp

    config rule
	    option name             Allow-Babel
	    option src              wan
	    option dest_port        6696
	    option proto            udp
	    option target           ACCEPT

    config rule
	    option name             Allow-Babel
	    option src              lan
	    option dest_port        6696
	    option proto            udp
	    option target           ACCEPT

    config rule
	    option name             Allow-SSH-wan
	    option src              wan
	    option dest_port        22
	    option proto            tcp
	    option target           ACCEPT

/etc/config/network

    config interface 'loopback'
	    option ifname 'lo'
	    option proto 'static'
	    option ipaddr '127.0.0.1'
	    option netmask '255.0.0.0'

    config interface 'wan'
	    option ifname 'wlan0'
	    option proto 'static'
	    option netmask '255.255.255.255'

    config interface 'lan'
	    option ifname 'eth0'
	    option type 'bridge'
	    option proto 'static'
	    option netmask '255.255.255.0'
	    option ip6addr 'fd64:2c08:9fa7:be40::1/64'
	    option ipaddr '172.16.3.25'

/etc/config/radvd

    config interface
	    option interface 'lan'
	    option AdvSendAdvert '1'
	    option AdvManagedFlag '0'
	    option AdvOtherConfigFlag '0'
	    list client ''
	    option ignore '0'

    config prefix
	    option interface 'lan'
	    option AdvOnLink '1'
	    option AdvAutonomous '1'
	    option ignore '0'
	    option AdvRouterAddr '1'
	    option prefix 'fd64:2c08:9fa7:be40::1/64'

    config route
	    option interface 'lan'
	    list prefix ''
	    option ignore '0'

    config rdnss
	    option interface 'lan'
	    list addr ''
	    option ignore '1'

    config dnssl
	    option interface 'lan'
	    list suffix ''
	    option ignore '1'

/etc/config/system

    config system
	    option timezone 'UTC'
	    option hostname 'benode'

    config timeserver 'ntp'
	    list server '0.openwrt.pool.ntp.org'
	    list server '1.openwrt.pool.ntp.org'
	    list server '2.openwrt.pool.ntp.org'
	    list server '3.openwrt.pool.ntp.org'
	    option enable_server '0'

/etc/config/ucitrack

    config network
	    option init network
	    list affects dhcp
	    list affects radvd

    config wireless
	    list affects network

    config firewall
	    option init firewall
	    list affects luci-splash
	    list affects qos
	    list affects miniupnpd

    config olsr
	    option init olsrd

    config dhcp
	    option init dnsmasq

    config dropbear
	    option init dropbear

    config httpd
	    option init httpd

    config fstab
	    option init fstab

    config qos
	    option init qos

    config system
	    option init led
	    list affects luci_statistics

    config luci_splash
	    option init luci_splash

    config upnpd
	    option init miniupnpd

    config ntpclient
	    option init ntpclient

    config samba
	    option init samba

    config tinyproxy
	    option init tinyproxy


/etc/config/wireless

    config wifi-device 'radio0'
	    option type 'mac80211'
	    option macaddr 'dc:9f:db:0a:59:82'
	    option hwmode '11ng'
	    option htmode 'HT20'
	    list ht_capab 'SHORT-GI-40'
	    list ht_capab 'TX-STBC'
	    list ht_capab 'RX-STBC1'
	    list ht_capab 'DSSS_CCK-40'
	    option channel '1'

    config wifi-iface
	    option device 'radio0'
	    option encryption 'none'
	    option mode 'adhoc'
	    option bssid '02:CA:FF:EE:BA:BE'
	    option network 'wan'
	    option ssid 'benode.relais.reseaulibre.ca'

### État actuel (sur le bullet):

# brctl show

    bridge name	bridge id		STP enabled	interfaces
    br-lan		8000.dc9fdb0b5982	no		eth0

# ip -6 ro

    fd64:2c08:9fa7:15:: via fe80::de9f:dbff:fe06:d4cd dev wlan0  proto 42  metric 1024 
    fd64:2c08:9fa7:15::100 via fe80::de9f:dbff:fe06:d4cd dev wlan0  proto 42  metric 1024 
    fd64:2c08:9fa7:be40::/64 dev br-lan  proto kernel  metric 256 
    fe80::/64 dev br-lan  proto kernel  metric 256 
    fe80::/64 dev wlan0  proto kernel  metric 256

# ./babelstatus 

    My MAC ID:  de:9f:db:ff:fe:0a:59:82
    *** Neighbours ***
    fe80::de9f:dbff:fe06:d4cd [unknown] if wlan0 reach fdfc rxcost 260 txcost 580 cost 589
    *** Exported routes ***
    172.16.3.25/32 prefix 172.16.3.25/32 metric 0
    fd64:2c08:9fa7:be40::1/128 prefix fd64:2c08:9fa7:be40::1/128 metric 0
    *** Routes ***
    fe80::de9f:dbff:fe06:d4cd [unknown] -> fd64:2c08:9fa7:15::/128-5ec368 prefix fd64:2c08:9fa7:15::/128 installed yes id de:9f:db:ff:fe:06:d4:cd metric 589 refmetric 0 via fe80::de9f:dbff:fe06:d4cd if wlan0
    fd64:2c08:9fa7:15::100/128-5ec368 prefix fd64:2c08:9fa7:15::100/128 installed yes id 02:e0:4c:ff:fe:20:57:ca metric 845 refmetric 256 via fe80::de9f:dbff:fe06:d4cd if wlan0


# ifconfig

    br-lan    Link encap:Ethernet  HWaddr DC:9F:DB:0B:59:82  
	      inet addr:172.16.3.25  Bcast:172.16.3.255  Mask:255.255.255.0
	      inet6 addr: fd64:2c08:9fa7:be40::1/64 Scope:Global
	      inet6 addr: fe80::de9f:dbff:fe0b:5982/64 Scope:Link
	      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
	      RX packets:482 errors:0 dropped:0 overruns:0 frame:0
	      TX packets:701 errors:0 dropped:0 overruns:0 carrier:0
	      collisions:0 txqueuelen:0 
	      RX bytes:55854 (54.5 KiB)  TX bytes:131598 (128.5 KiB)

    eth0      Link encap:Ethernet  HWaddr DC:9F:DB:0B:59:82  
	      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
	      RX packets:482 errors:0 dropped:0 overruns:0 frame:0
	      TX packets:678 errors:0 dropped:0 overruns:0 carrier:0
	      collisions:0 txqueuelen:1000 
	      RX bytes:62602 (61.1 KiB)  TX bytes:129260 (126.2 KiB)
	      Interrupt:4 

    lo        Link encap:Local Loopback  
	      inet addr:127.0.0.1  Mask:255.0.0.0
	      inet6 addr: ::1/128 Scope:Host
	      UP LOOPBACK RUNNING  MTU:16436  Metric:1
	      RX packets:7896 errors:0 dropped:0 overruns:0 frame:0
	      TX packets:7896 errors:0 dropped:0 overruns:0 carrier:0
	      collisions:0 txqueuelen:0 
	      RX bytes:538159 (525.5 KiB)  TX bytes:538159 (525.5 KiB)

    wlan0     Link encap:Ethernet  HWaddr DC:9F:DB:0A:59:82  
	      inet6 addr: fe80::de9f:dbff:fe0a:5982/64 Scope:Link
	      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
	      RX packets:316 errors:0 dropped:0 overruns:0 frame:0
	      TX packets:377 errors:0 dropped:0 overruns:0 carrier:0
	      collisions:0 txqueuelen:32 
	      RX bytes:39148 (38.2 KiB)  TX bytes:52294 (51.0 KiB)

# iptables --list

    Chain INPUT (policy ACCEPT)
    target     prot opt source               destination         

    Chain FORWARD (policy ACCEPT)
    target     prot opt source               destination         

    Chain OUTPUT (policy ACCEPT)
    target     prot opt source               destination


# ping fd64:2c08:9fa7:15::  # <-- Zoidberg

    PING fd64:2c08:9fa7:15:: (fd64:2c08:9fa7:15::): 56 data bytes
    64 bytes from fd64:2c08:9fa7:15::: seq=0 ttl=64 time=13.041 ms
    64 bytes from fd64:2c08:9fa7:15::: seq=1 ttl=64 time=2.484 ms
    64 bytes from fd64:2c08:9fa7:15::: seq=2 ttl=64 time=2.301 ms
    ^C
    --- fd64:2c08:9fa7:15:: ping statistics ---
    3 packets transmitted, 3 packets received, 0% packet loss
    round-trip min/avg/max = 2.301/5.942/13.041 ms

### Etat actuel (sur l'ordinateur)

# ifconfig eth0

    eth0      Link encap:Ethernet  HWaddr 14:da:e9:dd:ab:88  
              inet addr:172.16.3.26  Bcast:172.16.3.255  Mask:255.255.255.0
              inet6 addr: fd64:2c08:9fa7:be40:e8a4:7ca2:e91:640d/64 Scope:Global
              inet6 addr: fd64:2c08:9fa7:be40:16da:e9ff:fedd:ab88/64 Scope:Global
              inet6 addr: fe80::16da:e9ff:fedd:ab88/64 Scope:Link
              UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
              RX packets:25983 errors:0 dropped:0 overruns:0 frame:0
              TX packets:37873 errors:0 dropped:1 overruns:0 carrier:0
              collisions:0 txqueuelen:1000 
              RX bytes:5915636 (5.9 MB)  TX bytes:4163633 (4.1 MB)
              Interrupt:48 Base address:0x6000

# ip -6 ro

    fd64:2c08:9fa7:be40::/64 dev eth0  proto kernel  metric 256  expires 85977sec
    fe80::/64 dev eth0  proto kernel  metric 256 
    default via fe80::de9f:dbff:fe0b:5982 dev eth0  proto kernel  metric 1024  expires 1366sec


# ping6 fd64:2c08:9fa7:15::

    PING fd64:2c08:9fa7:15::(fd64:2c08:9fa7:15::) 56 data bytes
    ^C
    --- fd64:2c08:9fa7:15:: ping statistics ---
    9 packets transmitted, 0 received, 100% packet loss, time 7999ms

# ping6 fd64:2c08:9fa7:be40::1

    PING fd64:2c08:9fa7:be40::1(fd64:2c08:9fa7:be40::1) 56 data bytes
    64 bytes from fd64:2c08:9fa7:be40::1: icmp_seq=1 ttl=64 time=0.557 ms
    64 bytes from fd64:2c08:9fa7:be40::1: icmp_seq=2 ttl=64 time=0.550 ms
    64 bytes from fd64:2c08:9fa7:be40::1: icmp_seq=3 ttl=64 time=0.565 ms
    ^C
    --- fd64:2c08:9fa7:be40::1 ping statistics ---
    3 packets transmitted, 3 received, 0% packet loss, time 1998ms
    rtt min/avg/max/mdev = 0.550/0.557/0.565/0.020 ms



### Links
Links: [[zoidberg]] ~65dbm

[[!meta copyright="Copyright © 2012 Alexandre Guédon"]]

[[!meta license="""[[!toggle id="license" text="GFDL 1.2+"]][[!toggleable
id="license" text="Permission is granted to copy, distribute and/or modify this
document under the terms of the GNU Free Documentation License, Version 1.2 or
any later version published by the Free Software Foundation; with no Invariant
Sections, no Front-Cover Texts, and no Back-Cover Texts.  A copy of the license
is included in the section entitled [[GNU Free Documentation
License|meta/gfdl]]."]]"""]]
